#=  
Write a fasta format file of pseudo DNA strings that correspond to a 
population of alleles.  The population is given as a sequence of allele
frequency counts as produced by pop_counts64(neutral_poplist()).
There is a unique DNA string for each allele, and all DNA strings
differ from the all A string "AAA...AA" in one locus which is a "C".

These pseudo-DNA fasta files will be input to the DnaSP program which
computes a number of population genetics neutrality tests based on DNA data.
=#

@doc """function pseudo_dna( frequencies::Vector{Int64} )
frequences is a vector of positive integers corresponding to allele frequencies.
Returns a list of sum(frequences) strings where each string is the same length as frequences.
Each string is a sequences of "A"s followed by a "C" followed by another sequence of "A"s.
"""

function pseudo_dna( frequencies::Vector{Int64} )
  N = sum(frequencies)
  k = length(frequencies)
  base = string()
  for i = 1:k
    base = string(base,"A")
  end
  string_list = AbstractString[]
  i = 1
  while i <= k
    current = base
    current = string(base[1:(i-1)], "C", base[(i+1):end] )
    for j = 1:frequencies[i]
      push!(string_list,current)
    end
    i += 1
  end
  string_list
end

@doc """function write_dna_file( file_name::AbstractString, frequencies::Vector{Int64} )
Write the strings generated by pseudo_dna to a file in fasta format.
Each string is preceded by an identifier of the form ">seq\$i" where i is the strong number.
"""
      
function write_dna_file( file_name::AbstractString, frequencies::Vector{Int64} )
  fp = open( file_name, "w" )
  string_list = pseudo_dna(frequencies)
  i = 1
  for s in string_list
    write(fp, ">seq$i", "\n" )
    write(fp, s, "\n" )
    i += 1
  end
  close(fp)
end

function neutral_dna_file( file_name::AbstractString, N::Int64, mu::Float64; burn_in::Float64=1.0 )
  freqs = neutral_poplist( N, mu, 1, burn_in=burn_in )[1] 
  write_dna_file( file_name, pop_counts64(freqs) )
end

function power_conformist_dna_file( file_name::AbstractString, N::Int64, mu::Float64; burn_in::Float64=1.0, conformist_power::Float64=0.0 )
  freqs = power_conformist_poplist( N, mu, 1, burn_in=burn_in, conformist_power=conformist_power  )[1] 
  write_dna_file( file_name, pop_counts64(freqs) )
end
